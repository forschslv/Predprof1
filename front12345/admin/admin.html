<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –õ2–®</title>
    <link rel="stylesheet" href="/cafeteria_styles.css">
</head>
<body>
    <div class="container">
        <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <div class="navigation-hub">
            <div class="button-group">
                <button onclick="window.location.href='/admin/admin_menu'">üç± –ë–∞–∑–∞ –±–ª—é–¥</button>
                <button onclick="window.location.href='/admin/admin_module'">üìÖ –ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</button>
                <button onclick="window.location.href='/admin/admin_orders'">üí∞ –ó–∞–∫–∞–∑—ã –∏ –°—Ç–∞—Ç—É—Å—ã</button>
                <button onclick="window.location.href='/admin/admin_topups'">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
                <button onclick="window.location.href='/admin/admin_users'">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                <button onclick="window.location.href='/main'" class="secondary">üè† –í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
            </div>
        </div>

        <div class="stats-box">
            <h2>–ë—ã—Å—Ç—Ä—ã–π –æ—Ç—á–µ—Ç –ø–æ –≤—ã—Ä—É—á–∫–µ</h2>
            <input type="date" id="summaryDate">
            <button onclick="getSummary()">–ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É</button>
            <div id="summaryResult" style="margin-top:20px;"></div>
        </div>
    </div>

    <script src="/script.js"></script>
    <script>
        checkAuth();
        (async () => {
            try {
                const user = await apiRequest('/users/me');
                if (!(user.is_admin || user.is_cook)) {
                    window.location.href = '/main';
                    return;
                }

                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω, —Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏
                if (!user.is_admin) {
                    // —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                    const usersBtn = Array.from(document.querySelectorAll('.button-group button')).find(b => b.innerText.includes('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏'));
                    if (usersBtn) usersBtn.style.display = 'none';
                    // —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ó–∞–∫–∞–∑—ã –∏ –°—Ç–∞—Ç—É—Å—ã –¥–ª—è –ø–æ–≤–∞—Ä–æ–≤
                    const ordersBtn = Array.from(document.querySelectorAll('.button-group button')).find(b => b.innerText.includes('–ó–∞–∫–∞–∑—ã'));
                    if (ordersBtn) ordersBtn.style.display = 'none';
                    // —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –Ω–µ-–∞–¥–º–∏–Ω–æ–≤
                    const topupsBtn = Array.from(document.querySelectorAll('.button-group button')).find(b => b.innerText.includes('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è'));
                    if (topupsBtn) topupsBtn.style.display = 'none';
                    // —Å–∫—Ä—ã—Ç—å –±–ª–æ–∫ —Å–≤–æ–¥–∫–∏
                    const statsBox = document.querySelector('.stats-box');
                    if (statsBox) statsBox.style.display = 'none';
                }

                document.getElementById('summaryDate').value = new Date().toISOString().split('T')[0];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤', e);
                localStorage.clear();
                window.location.href = '/register_login/login';
            }
        })();

        async function getSummary() {
            const date = document.getElementById('summaryDate').value;
            const res = await apiRequest(`/admin/reports/summary?date_query=${date}`);
            let html = `<h3>–í—Å–µ–≥–æ –∑–∞ –¥–µ–Ω—å: ${res.total_revenue} ‚ÇΩ</h3><table><tr><th>–ë–ª—é–¥–æ</th><th>–ö–æ–ª-–≤–æ</th><th>–°—É–º–º–∞</th></tr>`;
            res.items.forEach(i => {
                html += `<tr><td>${i.dish}</td><td>${i.count}</td><td>${i.revenue} ‚ÇΩ</td></tr>`;
            });
            document.getElementById('summaryResult').innerHTML = html + `</table>`;
        }
    </script>
</body>
</html>